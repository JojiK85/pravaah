<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Become a Sponsor | PRAVAAH</title>

  <!-- Styles (kept inline for convenience) -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body { font-family: 'Orbitron', sans-serif; color:#fff; background:linear-gradient(120deg,#2c1a55,#3e5d75,#022c43,#5b2a86); background-size:400% 400%; animation:gradientMove 15s ease infinite; margin:0; padding-bottom:4rem; }
    @keyframes gradientMove { 0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%} }
    nav{display:flex;align-items:center;gap:1rem;padding:0.8rem 1.2rem}
    .logo{font-weight:700}
    .sponsor-section{max-width:900px;margin:4.5rem auto;padding:1rem;text-align:center}
    h1{font-size:2.2rem;text-shadow:0 0 12px cyan;margin-bottom:.6rem}
    p.lead{color:#cfdfe6;margin-bottom:1.5rem}
    .sponsor-form{display:flex;flex-direction:column;gap:12px;margin:0 auto;width:86%}
    .sponsor-form input,.sponsor-form textarea{padding:12px;border-radius:8px;border:1px solid cyan;background:rgba(0,0,0,0.45);color:#fff}
    .file-upload-label{display:flex;align-items:center;justify-content:center;gap:10px;padding:14px;border:2px dashed cyan;border-radius:12px;cursor:pointer;background:rgba(0,0,0,0.35);color:cyan}
    .file-input{display:none}
    .file-preview{display:none;margin-top:6px;padding:8px;border-radius:8px;border:1px solid cyan;background:rgba(0,255,255,0.06);color:cyan;justify-content:space-between;align-items:center}
    .btn{background:cyan;color:black;padding:12px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
    .status-text{color:cyan;margin-top:10px}
    @media(max-width:600px){ .sponsor-form{width:94%} h1{font-size:1.6rem} }
  </style>
</head>
<body>

  <nav>
    <div class="logo">PRAVAAH</div>
  </nav>

  <section class="sponsor-section">
    <h1>Become a Sponsor</h1>
    <p class="lead">Fill this form and upload your proposal deck (PDF / PNG / JPG). We'll get back to you soon.</p>

    <form id="sponsorForm" class="sponsor-form" autocomplete="off">
      <input id="name" name="name" type="text" placeholder="Your Full Name" required />
      <input id="company" name="company" type="text" placeholder="Company / Brand Name" required />
      <input id="email" name="email" type="email" placeholder="Email Address" required />
      <input id="phone" name="phone" type="tel" placeholder="Phone Number" required />
      <textarea id="message" name="message" rows="4" placeholder="Message (Optional)"></textarea>

      <label class="file-upload-label" for="fileInput">
        <i class="fa-solid fa-upload"></i><span id="fileLabelText">Upload your deck / proposal (optional)</span>
      </label>
      <input id="fileInput" class="file-input" type="file" accept=".pdf,.png,.jpg,.jpeg" />

      <div class="file-preview" id="filePreview">
        <div id="fileName">—</div>
        <button type="button" id="removeFile" style="background:transparent;border:none;color:#ff6b6b;font-size:1.1rem;cursor:pointer">Remove</button>
      </div>

      <button id="submitBtn" type="submit" class="btn">Submit</button>
    </form>

    <div id="statusMessage" class="status-text" role="status" aria-live="polite"></div>
  </section>

  <script>
    // ***** IMPORTANT: replace with your deployed Apps Script URL *****
    const SCRIPT_URL = "https://script.google.com/macros/s/YOUR_DEPLOYED_WEBAPP_ID/exec";

    const sponsorForm = document.getElementById("sponsorForm");
    const fileInput = document.getElementById("fileInput");
    const filePreview = document.getElementById("filePreview");
    const fileNameEl = document.getElementById("fileName");
    const removeFileBtn = document.getElementById("removeFile");
    const statusMessage = document.getElementById("statusMessage");
    const submitBtn = document.getElementById("submitBtn");
    const fileLabelText = document.getElementById("fileLabelText");

    let selectedFile = null;
    let selectedBase64 = null; // base64 without data: prefix

    // File selection UI
    fileInput.addEventListener("change", () => {
      const f = fileInput.files[0];
      if (!f) {
        selectedFile = null;
        selectedBase64 = null;
        filePreview.style.display = 'none';
        fileLabelText.textContent = 'Upload your deck / proposal (optional)';
        return;
      }
      selectedFile = f;
      fileNameEl.textContent = f.name;
      filePreview.style.display = 'flex';
      fileLabelText.textContent = 'Change file';
      // Convert to base64 now (so submit is simpler)
      const reader = new FileReader();
      reader.onload = () => {
        // reader.result is "data:*/*;base64,AAAA..."
        const dataUrl = reader.result || "";
        const commaIndex = dataUrl.indexOf(',');
        selectedBase64 = commaIndex >= 0 ? dataUrl.slice(commaIndex + 1) : dataUrl;
      };
      reader.onerror = () => {
        selectedBase64 = null;
        statusMessage.textContent = "❌ Failed to read file.";
      };
      reader.readAsDataURL(f);
    });

    removeFileBtn.addEventListener("click", () => {
      fileInput.value = "";
      selectedFile = null;
      selectedBase64 = null;
      filePreview.style.display = 'none';
      fileLabelText.textContent = 'Upload your deck / proposal (optional)';
    });

    // Submit handler: build JSON payload and POST as text/plain
    sponsorForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      statusMessage.textContent = "";
      submitBtn.disabled = true;

      // Gather values
      const name = document.getElementById("name").value.trim();
      const company = document.getElementById("company").value.trim();
      const email = document.getElementById("email").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const message = document.getElementById("message").value.trim();

      // Basic client validation
      if (!name || !company || !email || !phone) {
        statusMessage.textContent = "⚠️ Please fill required fields.";
        submitBtn.disabled = false;
        return;
      }

      // Prepare payload
      const payload = {
        name, company, email, phone, message
      };

      if (selectedFile && selectedBase64) {
        // limit size approx 8MB (same as server check)
        const approxBytes = Math.ceil((selectedBase64.length * 3) / 4);
        if (approxBytes > 8 * 1024 * 1024) {
          statusMessage.textContent = "⚠️ File too large (limit ~8MB).";
          submitBtn.disabled = false;
          return;
        }
        payload.fileName = selectedFile.name;
        payload.fileType = selectedFile.type || "application/octet-stream";
        payload.fileData = selectedBase64; // already stripped of data: prefix
      }

      try {
        statusMessage.textContent = "Submitting…";
        // Use Content-Type text/plain so Apps Script receives e.postData.contents reliably
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify(payload),
          keepalive: true
        });

        // parse response (Apps Script returns JSON)
        const result = await res.json().catch(() => null);
        if (result && result.status === "success") {
          statusMessage.textContent = "✔ Submitted! Redirecting…";
          setTimeout(() => { window.location.href = "thankyou.html"; }, 900);
        } else {
          // show error from server if available
          const msg = (result && result.message) ? result.message : "Server error. Try again.";
          statusMessage.textContent = "⚠️ " + msg;
          console.warn("Submission response:", result);
        }
      } catch (err) {
        console.error("Submit error:", err);
        statusMessage.textContent = "❌ Network error. Please try again.";
      } finally {
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
